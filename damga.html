<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Dijital Damga Kartı</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css">
<style>
  /* Temel stil sıfırlama */
  * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
/* Düzenle: */
body {
  font-family: 'Arial', sans-serif;
  background-color: #f5f5f5;
  padding-top: 0; /* Sabit başlık yüksekliğine göre ayarlayın */
}
.card {
  width: 100vw; /* ekran genişliğine göre ayarlanır */
  margin: 0;
  margin-top: 0;
  padding: 5px;

}

@keyframes blink {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.8;
  }
}

.glf-button {
  animation: blink 0.9s linear infinite;
}

.glf-button {
  position: fixed;
  top: -2px;
  left: -2px;
  width: 100%;
  z-index: 100;
  display: flex;
  justify-content: center;
  align-items: center;

}

hr {
  margin: 20px 0;
  border: none;
  border-top: 1px solid #e5e5e5;
}

.title {
  font-size: 18px;
  font-weight: bold;
  color: #333;
  text-align: center;
  margin-bottom: 20px;
}
.stamps {
    display: flex;
    margin-bottom: 20px;
    min-width: auto;
    margin-left: auto;
    margin-right: auto;
    flex-wrap: wrap;
    justify-content: space-around;
}

.stamp {
  width: 50px;
  height: 50px;
  background-color: #e5e5e5;
  display: flex;
  justify-content: center;
  align-items: center;
  color: #333;
  font-weight: bold;
  font-size: 20px;
  margin: 5px;
  border-radius: 50%;
  border: 2px solid #33333358;
}

.stamp.complete {
  background-color: #4caf50;
  color: #ffffff;
}

.stamp i {
  margin-left: 5px;
}

.qr-code {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: 20px;
}

input {
  outline: none;
  text-align: center;
  width: 85vw;
  height: 50px;
  font-size: 20px;
  background-color: #f5f5f5;
  border: 1px solid #e5e5e5;
  border-radius: 10px;
  margin-top: 10px;
}

input::placeholder {
  color: #ffffff;
}

@media (min-width: 350px) {
    .stamp {
      width: 60px;
      height: 60px;
    }
.card {
  width: 350px; /* ekran genişliğine göre ayarlanır */
  margin: auto;
}
input {
  width: 310px; /* ekran genişliğine göre ayarlanır */
  height: 50px;
}
  }
  @media (min-width: 700px) {
.card {
  width: 750px; /* ekran genişliğine göre ayarlanır */
  margin: auto;
  background-color: #fffffff6;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.614);
}
input {
  width: 650px; /* ekran genişliğine göre ayarlanır */
  height: 50px;
}
  }
  .profil {
  position: fixed;
  top: 2px;
  left: 45px;
  transform: translateX(-50%);
  z-index: 100;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 60px;
  height: 60px;
}

.profil img {
  width: 100%;
  height: 100%;
  border-radius: 50%;
}
.stamp.gratis {
  background-color: #f5e102d7;
  border: 2px solid #213a17c5;
  border-radius: 20%;
  width: auto;
  font-size: 15px;
}
table {
  width: 100%;
  margin: 0 auto;
  text-align: center;
}

th {
  font-size: 16px;
}

td, th {
  padding: 2px;
  font-size: 12px;
}
#kupon{
  border: 5px dashed rgba(6, 6, 6, 0.655);
  padding: 10px;
  background-color: #ffffff;
  box-shadow: 0 12px 8px rgba(0, 0, 0, 0.614);
}
</style>
</head>
<body>
  
<div class="card">
<span class="glf-button" style="background-color: #ff7300ed;" data-glf-cuid="33226b9d-c5c5-440e-9041-c766b47163f4" data-glf-ruid="b272e84c-1ea6-43e3-bd3c-b95cfb8967e4">      Se MENY og Bestill 👆</span>

<div class="profil">
<img src="https://i.hizliresim.com/51zdn92.png" alt="">
</div>
<br><br><br><br><br>
<h1 class="title">Digitalt StempelKort</h1>

<div id="kupon" class="stamps">   </div>

<hr>
<h4 style="text-align: center;">Vis QR-koden din til personalet hver gang du henter en stor pizza.</h4>
<h1 class="title"><span class="completed-pizzas" id="completed"><input id="inp" type="text" pattern="\d{8}" maxlength="8" inputmode="numeric" placeholder="Registrer ditt mobilnummer 📱" onkeyup="method()" oninput="this.value = this.value.replace(/[^0-9]/g, ''); updateInputBackground();">
</span>
</h1>

<div class="qr-code">
  <div id="QRimage"></div>
  </div>

  <p style="text-align: center; font-size:13px;">
    Registrer kun engang ditt mobilnummer og vis QR-koden din til personalet hver gang du henter en stor pizza. 
    <br>For hver pizza vil du motta en kupong. Når du har samlet 10 kuponger, få en gratis valgfri stor pizza på din 11. pizza. 
    <br>Tilbudet gjelder bare for store pizzaer.

  </p>
  <hr>
  <table>
    <tr>
      <td>
        <h3>🕒 Åpningstider</h3>
        <p>Mandag - Søndag	<br> 00:00 - 00:00</p>
        <hr>
        <h3>🗺️ Adresse</h3>
        <p>xxx 1, 4629 Kristiansand S</p>
      </td>
      <td>
        <h3>💰 Betalingsmetode</h3>
        <p>Vipps / Kort <br> kontant</p>
        <hr>
        <h3>☎️ Telefonnummer</h3>
        <p>Ring oss på <a href="tel:95529999">9552 9999</a></p>
      </td>
    </tr>
  </table>
  
</div>

</div>
<table id="demo">   </table>
<script src="https://www.fbgcdn.com/embedder/js/ewm2.js" defer async ></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
   import { getDatabase, ref, onValue, set, remove, update } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js";
   const firebaseConfig = { databaseURL: "https://charlies-pizza-default-rtdb.europe-west1.firebasedatabase.app",
        };
  
   // Firebase yapılandırmasını başlat
   initializeApp(firebaseConfig);
   const database = getDatabase();
   const commentsReference = ref(database);

         guncelle();
function guncelle() {

  function createStamps(numActive) {
  kupon.innerHTML = null;
  for (let index = 1; index <= 10; index++) {
    if (index <= numActive) {
      kupon.innerHTML += `<div class="stamp complete"> ${index} <i class="fas fa-check"></i></div>`;
    } else {
      kupon.innerHTML += `<div class="stamp"> ${index} </div>`;
    }
  }
}

onValue(commentsReference, (snapshot) => {
  demo.innerHTML = "";
  kupon.innerHTML = null;

  const jsonString = JSON.stringify(snapshot);
  const parsedObject = JSON.parse(jsonString);

  let foundMatch = false;

  for (const key in parsedObject) {
    
    if (key == localStorage.getItem('mobilNumara')) {
      createStamps(parsedObject[key]); // Eşleşme bulunduğunda aktif kuponları oluştur
      foundMatch = true;
      break;
    }
  }

  if (!foundMatch) {
    createStamps(0); // Eşleşme bulunamadığında pasif kuponları oluştur
  }
});
}

window.guncelle = guncelle;
</script>
  

<script>
function updateInputBackground() {
  var inp = document.getElementById("inp");
  if (inp.value.length === 8) {
    inp.style.backgroundColor = "#14cb1a76"; // 8 haneli numara için yeşil arka plan
  } else {
    inp.style.backgroundColor = "#ee070792"; // 8'den az haneli numara için kırmızı arka plan
  }
}

inp.value = localStorage.getItem('mobilNumara');

  method();
  function method() {

    // Numara tam 8 girilince yesil, eksikse kirmizi
    updateInputBackground();
    
    var QRimage = document.getElementById("QRimage");
    var inp = document.getElementById("inp");

    // localStorage'ye girilen numarayı kaydedin
    localStorage.setItem('mobilNumara', inp.value);

    QRimage.innerHTML = null;
    var QR = new QRCode(QRimage);
    QR.makeCode("https://bestill.online/kayit.html?n="+inp.value);

    guncelle(); 
  }
</script>

</body>
</html>
