<button id="BTN1" onclick="PIZZAEKLE(-1);">➖</button>
<button id="BTN2" onclick="PIZZAEKLE(1);">➕</button>
<br><br>
<input type="tel" id="benimNo" placeholder="Kendi Numaran" autocomplete="off">
<button onclick="MOBILKAYIT();">GIR</button>
<br><br>
<input type="tel" id="davetliNo" placeholder="Davet et" autocomplete="off"> 
<button onclick="DAVETLIEKLE(davetliNo.value);">GIR</button><br>
<br><br>
Pizzalarim; <span id="pizzalarim"></span><br><br>
Puanlarim; <span id="puanlarim"></span><br><br>
Davetci; <span id="davetci"></span><br><br>
Davetliler; <span id="davetliler"></span>

<script type="module">
  
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
  import { getDatabase, ref, set, get, onValue } 
  from "https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js";

  const firebaseConfig = {
    databaseURL: "https://verv-en-default-rtdb.firebaseio.com",
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  
  // Sayfa yüklendiğinde localStorage'dan kayıtlı numarayı çek ve input'a yerleştir
  benimNo.value = localStorage.getItem('MOBIL') || '';

  window.RESULT = function() {
  onValue(ref(database, benimNo.value), (snapshot) => {
    davetliler.innerHTML = null;
    davetci.innerHTML = null;
    pizzalarim.innerHTML = null;
    puanlarim.innerHTML = null;
    
    snapshot.forEach((childSnapshot) => {
        const childKey = childSnapshot.key;
        const childValue = childSnapshot.val();
        if (childKey ==="PIZZA"){
        pizzalarim.innerHTML = `${childValue}`;
        }else if (childKey ==="PUAN"){
        puanlarim.innerHTML = `${childValue}`;
        }else if (childKey ==="DAVETCI"){
        davetci.innerHTML = `${childValue}`;
        }else if (childKey ==="DAVETLILER"){
        davetliler.innerHTML += `${childValue}`;
        }
           
      });
    });
  };
  RESULT();
  
  window.MOBILKAYIT = function() {
    localStorage.setItem('MOBIL', benimNo.value);
    RESULT();
  };

  window.PIZZAEKLE = function(increment) {
   set(ref(database, `${benimNo.value}/PIZZA`), Number(pizzalarim.innerText) + increment); 
  }

  window.DAVETLIEKLE = function(davetli) {
  if (!davetliler.innerHTML) { set(ref(database, `${benimNo.value}/PUAN`), 0); } 
    
  if (davetliler.innerText.includes(davetli) || !davetliNo.value.trim() || davetliNo.value === benimNo.value){
  alert(`Bu numara: ${davetliNo.value} zaten eklenmiş veya geçersiz.`);
    
  }else{
      
  set(ref(database, `${benimNo.value}/DAVETLILER`), `${davetliler.innerHTML}, ${davetli}`);
  set(ref(database, `${davetliNo.value}/DAVETCI`), Number(benimNo.value));
  set(ref(database, `${davetli}/PIZZA`), 0);
  set(ref(database, `${davetli}/PUAN`), 0);
  davetliNo.value = null;
  }
    }
</script>
