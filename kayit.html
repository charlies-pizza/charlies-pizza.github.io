<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
</head>

<table id="demo">   </table>

<script type="module">
 let durum = true;
 
 import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
 import { getDatabase, ref, onValue, set, remove, update } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js";
 const firebaseConfig = { databaseURL: "https://charlies-pizza-default-rtdb.europe-west1.firebasedatabase.app",
      };

 // Firebase yapılandırmasını başlat
 initializeApp(firebaseConfig);
 const database = getDatabase();
 const commentsReference = ref(database);


 const urlParams = new URLSearchParams(window.location.search);
 const nValue = urlParams.get("n"); 
 
 function saklananSifreyiKontrolEt() {
  let saklananSifre = localStorage.getItem("sifre");
  let dogruSifre = "1919";

  if (saklananSifre === dogruSifre) {
    calistir();
    return true;
  }

  return false;
}

function sifreAl() {
  if (saklananSifreyiKontrolEt()) {
    return;
  }

  let sifre = prompt("Lütfen şifrenizi girin", "");
  let dogruSifre = "1919";

  if (sifre === dogruSifre) {
    localStorage.setItem("sifre", sifre);
    alert("Şifre doğru!");
    calistir();
  } else {
    alert("Yanlış şifre. Lütfen tekrar deneyin.");
  }
}

if (!saklananSifreyiKontrolEt()) {
  sifreAl();
}

function calistir(){
onValue(commentsReference, (snapshot) => {
  const jsonString = JSON.stringify(snapshot);
  const parsedObject = JSON.parse(jsonString);

  if (parsedObject.hasOwnProperty(nValue)) {
    setTimeout(() => {
      set(ref(database, nValue), Number(parsedObject[nValue]) + 1);
    }, 50);
  } else {
    setTimeout(() => {
      set(ref(database, nValue), 1);
    }, 50);
  }
});

}
</script>
</body>
</html>
