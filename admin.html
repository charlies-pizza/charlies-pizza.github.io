<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }
  table {
    width: 90%;
    border-collapse: collapse;
    margin-top: 20px;
    margin:auto;
  }

  th, td {
    padding: 10px;
    text-align: center;
    border-bottom: 2px solid #ddd;
    cursor:pointer;
  }
  th {
    background-color: #4CAF50;
    color: white;
  }
  .input{
  width:40px;
  }
</style>
  <body>
<table>  <th>MOBIL NR</th> <th>KUPONG</th> <th>DELETE</th> <th>RESET</th> </table>
<table id="demo">   </table>
<script type="module">

 let status = true;
 
 import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
 import { getDatabase, ref, onValue, set, remove, update } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js";
 const firebaseConfig = { databaseURL: "https://bestill-pizza-default-rtdb.europe-west1.firebasedatabase.app" };

 // Firebase yapılandırmasını başlat
 initializeApp(firebaseConfig);
 const database = getDatabase();
 const commentsReference = ref(database);



 function saklananSifreyiKontrolEt() {
  let saklananSifre = localStorage.getItem("sifre");
  let dogruSifre = "1919";

  if (saklananSifre === dogruSifre) {
    calistir();
    return true;
  }

  return false;
}

function sifreAl() {
  if (saklananSifreyiKontrolEt()) {
    return;
  }

  let sifre = prompt("Lütfen şifrenizi girin", "");
  let dogruSifre = "1919";

  if (sifre === dogruSifre) {
    localStorage.setItem("sifre", sifre);
    alert("Şifre doğru!");
    calistir();
  } else {
    alert("Yanlış şifre. Lütfen tekrar deneyin.");
  }
}

if (!saklananSifreyiKontrolEt()) {
  sifreAl();
}

function calistir() {
 
 onValue(commentsReference, (snapshot) => {
 demo.innerHTML = "";
 
 const jsonString = JSON.stringify(snapshot);
 const parsedObject = JSON.parse(jsonString);

 
 for (const key in parsedObject) {
 demo.innerHTML += `<tr> <td> ${key} </td> 
 <td> <span id="${key}" data-value="${parsedObject[key]}">⬅️</span> <input id="${key}" class="input" type="number" value="${parsedObject[key]}"> <span id="${key}" data-value="${parsedObject[key]}">➡️</span> </td>
 <td id="${key}">🗑️</td> <td id="${key}">🔄</td> </tr>`;

}
});

onclick = () => {

if (event.target.innerText === "🗑️") {
remove(ref(database, event.target.id));
}

if (event.target.innerText === "🔄") {
  set(ref(database, event.target.id), 0);
}

if (event.target.tagName === "INPUT") {
set(ref(database, event.target.id), event.target.value);
}

if (event.target.outerText == "➡️" && event.target.dataset.value < 10) {
    const currentValue = parseInt(event.target.dataset.value);
    set(ref(database, event.target.id), currentValue + 1 );
}else if (event.target.outerText == "⬅️" && event.target.dataset.value > 0) {
    const currentValue1 = parseInt(event.target.dataset.value);
    set(ref(database, event.target.id), currentValue1 - 1 );
}
}
}
</script>
</body>
</html>
